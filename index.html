<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Disponibilités logements</title>
    <style>
        /* Fond plein écran */
        body, html {
            height: 100%;
            margin: 0;
            font-family: Arial, sans-serif;
            color: #fff;
            background-image: url('https://storage.e.jimdo.com/cdn-cgi/image/quality=100,fit=scale-down,format=auto,width=2560,height=1707/image/278216604/08ee4c1c-f126-48b7-820b-c55287c4bc6b.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        /* Centrer le formulaire */
        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
        }

        .form-box {
            background-color: rgba(0,0,0,0.7);
            padding: 30px 40px;
            border-radius: 12px;
            text-align: center;
            min-width: 300px;
        }

        select, button {
            padding: 8px;
            margin: 10px 0;
            width: 100%;
            max-width: 250px;
        }

        #resultat {
            margin-top: 20px;
            font-weight: bold;
        }

        h2 {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="form-box">
        <h2>Vérifiez la disponibilité</h2>

        <label>Choisissez un logement :</label>
        <select id="logement-select">
            <option value="">--Sélectionner--</option>
        </select>

        <label>Choisissez une semaine :</label>
        <select id="date-select">
            <option value="">--Sélectionner--</option>
        </select>

        <div id="resultat"></div>
    </div>
</div>

<!-- PapaParse pour lire Google Sheets -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<script>
const sheetId = "1ewqwedsuXVDG1Dc24vEGK-MAhkp35zoowgD2-WZVohE"; 
const sheetUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv`;

let logements = [];

// Charger les données depuis Google Sheets
Papa.parse(sheetUrl, {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
        logements = results.data;

        // Remplir la liste des logements
        const selectLog = document.getElementById("logement-select");
        const noms = [...new Set(logements.map(l => l.Logement).filter(Boolean))];
        noms.forEach(nom => {
            const opt = document.createElement("option");
            opt.value = nom;
            opt.textContent = nom;
            selectLog.appendChild(opt);
        });
    }
});

// Remplir les dates disponibles et afficher le résultat automatiquement
const logementSelect = document.getElementById("logement-select");
const dateSelect = document.getElementById("date-select");
const divRes = document.getElementById("resultat");

logementSelect.addEventListener("change", () => {
    const logementChoisi = logementSelect.value;
    dateSelect.innerHTML = '<option value="">--Sélectionner--</option>';
    divRes.innerHTML = ''; // Efface le résultat précédent

    if(!logementChoisi) return;

    const dates = logements
        .filter(l => l.Logement === logementChoisi)
        .map(l => l.Date_debut)
        .filter(Boolean);

    dates.forEach(d => {
        const opt = document.createElement("option");
        opt.value = d;
        opt.textContent = d;
        dateSelect.appendChild(opt);
    });
});

dateSelect.addEventListener("change", () => {
    const logementChoisi = logementSelect.value;
    const dateChoisie = dateSelect.value;

    if (!logementChoisi || !dateChoisie) {
        divRes.innerHTML = `<p>L'appartement choisi n'est pas disponible.</p>`;
        return;
    }

    const tarif = logements.find(l => l.Logement === logementChoisi && l.Date_debut === dateChoisie);

    if(tarif && tarif.Prix_semaine) {
        // Afficher toutes les informations disponibles
        let resultHtml = `<p>Le logement <strong>${logementChoisi}</strong> choisi est disponible !</p>`;
        resultHtml += `<p>Prix de la semaine : ${tarif.Prix_semaine} €<br>`;
        if(tarif.Taxe_sejour) resultHtml += `Taxe de séjour : ${tarif.Taxe_sejour} €<br>`;
        if(tarif.Prix_draps) resultHtml += `Prix des draps : ${tarif.Prix_draps} €<br>`;
        if(tarif.Prix_menage) resultHtml += `Prix du ménage : ${tarif.Prix_menage} €</p>`;

        divRes.innerHTML = resultHtml;
    } else {
        divRes.innerHTML = `<p>L'appartement choisi n'est pas disponible.</p>`;
    }
});
</script>

</body>
</html>
