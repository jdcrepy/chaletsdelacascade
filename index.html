<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Disponibilit√©s logements</title>
    <style>
        /* Fond plein √©cran */
        body, html {
            height: 100%;
            margin: 0;
            font-family: Arial, sans-serif;
            color: #fff;
            background-image: url('https://storage.e.jimdo.com/cdn-cgi/image/quality=100,fit=scale-down,format=auto,width=2560,height=1707/image/278216604/08ee4c1c-f126-48b7-820b-c55287c4bc6b.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        /* Centrer le formulaire */
        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
        }

        .form-box {
            background-color: rgba(0,0,0,0.7);
            padding: 30px 40px;
            border-radius: 12px;
            text-align: center;
            min-width: 300px;
        }

        h2 {
            margin-bottom: 20px;
        }

        label {
            display: block;      /* Forcer le label sur sa propre ligne */
            margin-top: 10px;
        }

        select {
            display: block;      /* Forcer la liste d√©roulante sur sa propre ligne */
            margin: 5px auto 10px auto;
            padding: 8px;
            width: 100%;
            max-width: 250px;
        }

        #resultat {
            margin-top: 20px;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="form-box">
        <h2>V√©rifiez la disponibilit√©</h2>

        <label>Choisissez un logement :</label>
        <select id="logement-select">
            <option value="">--S√©lectionner--</option>
        </select>

        <label>Choisissez une semaine :</label>
        <select id="date-select">
            <option value="">--S√©lectionner--</option>
        </select>

        <div id="resultat"></div>
    </div>
</div>

<!-- PapaParse pour lire Google Sheets -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<script>
const sheetId = "1ewqwedsuXVDG1Dc24vEGK-MAhkp35zoowgD2-WZVohE"; 
const sheetUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv`;

let logements = [];

// Charger les donn√©es depuis Google Sheets
Papa.parse(sheetUrl, {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
        logements = results.data;

        // V√©rifier les donn√©es charg√©es
        console.log(logements);

        // Remplir la liste des logements
        const selectLog = document.getElementById("logement-select");
        const noms = [...new Set(logements.map(l => l.Logement).filter(Boolean))];
        noms.forEach(nom => {
            const opt = document.createElement("option");
            opt.value = nom;
            opt.textContent = nom;
            selectLog.appendChild(opt);
        });
    },
    error: function(err) {
        console.error("Erreur lors du chargement du Google Sheet :", err);
        document.getElementById("resultat").innerHTML = `<p>Impossible de charger les donn√©es. V√©rifiez que le Google Sheet est publi√© sur le web.</p>`;
    }
});

// Remplir les dates disponibles et afficher le r√©sultat automatiquement
const logementSelect = document.getElementById("logement-select");
const dateSelect = document.getElementById("date-select");
const divRes = document.getElementById("resultat");

logementSelect.addEventListener("change", () => {
    const logementChoisi = logementSelect.value;
    dateSelect.innerHTML = '<option value="">--S√©lectionner--</option>';
    divRes.innerHTML = ''; // Efface le r√©sultat pr√©c√©dent

    if(!logementChoisi) return;

    const dates = logements
        .filter(l => l.Logement === logementChoisi)
        .map(l => l.Date_debut)
        .filter(Boolean);

    dates.forEach(d => {
        const opt = document.createElement("option");
        opt.value = d;
        opt.textContent = d;
        dateSelect.appendChild(opt);
    });
});

dateSelect.addEventListener("change", () => {
    const logementChoisi = logementSelect.value;
    const dateChoisie = dateSelect.value;

    if (!logementChoisi || !dateChoisie) {
        divRes.innerHTML = `<p>D√©sol√©, l'appartement <strong>${logementChoisi}</strong> n'est plus disponible sur la periode demand√©e.</p>`;
        return;
    }

    const tarif = logements.find(l => l.Logement === logementChoisi && l.Date_debut === dateChoisie);

    if (tarif && tarif.Prix_semaine) {
    let resultHtml = `<p>Le logement <strong>${logementChoisi}</strong> choisi est disponible !</p>`;
    resultHtml += `<p>Prix de la semaine : ${tarif.Prix_semaine}<br>`;
    if (tarif.Taxe_sejour) resultHtml += `Taxe de s√©jour : ${tarif.Taxe_sejour}<br>`;
    if (tarif.Prix_draps) resultHtml += `Prix des draps : ${tarif.Prix_draps}<br>`;
    if (tarif.Prix_menage) resultHtml += `Prix du m√©nage : ${tarif.Prix_menage}</p>`;

    // üîπ Nouveau lien mailto dynamique avec objet + corps pr√©remplis
    const mailObjet = encodeURIComponent(`Demande de r√©servation ‚Äì ${logementChoisi}`);
    const mailCorps = encodeURIComponent(
        `Bonjour,\n\nJe souhaite r√©server le logement "${logementChoisi}" pour la semaine du ${dateChoisie}.\n\nPouvez-vous me confirmer la disponibilit√© et les modalit√©s de r√©servation ?\n\nCordialement,\n[Votre nom]`
    );

    const mailLink = `mailto:cascadechatel@gmail.com?subject=${mailObjet}&body=${mailCorps}`;

    resultHtml += `<p>Si vous souhaitez r√©server, merci de nous contacter par mail √† 
    <a href="${mailLink}" style="color:#ffd700;">cascadechatel@gmail.com</a> 
    ou par t√©l√©phone au <strong>04 50 73 22 77</strong>.</p>`;

    divRes.innerHTML = resultHtml;
} else {
    divRes.innerHTML = `<p>D√©sol√©, l'appartement <strong>${logementChoisi}</strong> n'est plus disponible sur la p√©riode demand√©e.</p>`;
}

});
</script>

</body>
</html>


